import type { OrderDirection } from '../../types';
import { createSvgIconImage } from './utils';

const ICON_ACTIVE_COLOR = '#FFFFFF';
const ICON_NORMAL_COLOR = '#0E0121';
const REPLACE_COLOR = 'REPLACE_COLOR';
const REPLACE_COLOR_REGEX = new RegExp(REPLACE_COLOR, 'g');

const noSortNoFilter = `
  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_6476_91060)">
      <path d="M17.8504 4.70813H2.15008C1.57659 4.70813 1.11169 5.17303 1.11169 5.74651V5.74805C1.11169 6.32153 1.57659 6.78643 2.15008 6.78643H17.8504C18.4239 6.78643 18.8888 6.32153 18.8888 5.74805V5.74651C18.8888 5.17303 18.4239 4.70813 17.8504 4.70813Z" fill="${REPLACE_COLOR}"/>
      <path d="M14.6676 8.96167H5.00371C4.43023 8.96167 3.96533 9.42657 3.96533 10.0001V10.0016C3.96533 10.5751 4.43023 11.04 5.00371 11.04H14.6676C15.2411 11.04 15.706 10.5751 15.706 10.0016V10.0001C15.706 9.42657 15.2411 8.96167 14.6676 8.96167Z" fill="${REPLACE_COLOR}"/>
      <path d="M11.8155 13.2152H7.85735C7.28387 13.2152 6.81897 13.6801 6.81897 14.2536V14.2551C6.81897 14.8286 7.28387 15.2935 7.85735 15.2935H11.8155C12.389 15.2935 12.8539 14.8286 12.8539 14.2551V14.2536C12.8539 13.6801 12.389 13.2152 11.8155 13.2152Z" fill="${REPLACE_COLOR}"/>
    </g>
    <defs>
      <clipPath id="clip0_6476_91060">
        <rect width="20" height="20" fill="white"/>
      </clipPath>
    </defs>
  </svg>
`;
const descSortNoFilter = `
  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_6476_91062)">
      <g clip-path="url(#clip1_6476_91062)">
        <path d="M16.8664 4.70679H1.16759C0.594111 4.70679 0.129211 5.17169 0.129211 5.74517C0.129211 6.31865 0.594111 6.78355 1.16759 6.78355H16.8664C17.4399 6.78355 17.9048 6.31865 17.9048 5.74517C17.9048 5.17169 17.4399 4.70679 16.8664 4.70679Z" fill="${REPLACE_COLOR}"/>
        <path d="M13.6851 8.96033H4.02123C3.44775 8.96033 2.98285 9.42523 2.98285 9.99871C2.98285 10.5722 3.44775 11.0371 4.02123 11.0371H13.6851C14.2586 11.0371 14.7235 10.5722 14.7235 9.99871C14.7235 9.42523 14.2586 8.96033 13.6851 8.96033Z" fill="${REPLACE_COLOR}"/>
        <path d="M10.833 13.2123H6.87487C6.30139 13.2123 5.83649 13.6772 5.83649 14.2507C5.83649 14.8241 6.30139 15.289 6.87487 15.289H10.833C11.4065 15.289 11.8714 14.8241 11.8714 14.2507C11.8714 13.6772 11.4065 13.2123 10.833 13.2123Z" fill="${REPLACE_COLOR}"/>
        <path d="M17.0095 15.8721C16.8312 15.8721 16.6602 15.8013 16.5341 15.6752C16.408 15.5491 16.3372 15.3781 16.3372 15.1998V10.1879C16.3372 10.0094 16.4081 9.83823 16.5343 9.71202C16.6606 9.5858 16.8317 9.51489 17.0102 9.51489C17.1887 9.51489 17.3599 9.5858 17.4861 9.71202C17.6124 9.83823 17.6833 10.0094 17.6833 10.1879V15.1998C17.6833 15.3781 17.6124 15.5491 17.4864 15.6752C17.3603 15.8013 17.1878 15.8721 17.0095 15.8721Z" fill="${REPLACE_COLOR}"/>
        <path d="M17.0141 16.9089C16.9258 16.9095 16.8384 16.8926 16.7567 16.859C16.6751 16.8255 16.601 16.776 16.5387 16.7135L14.342 14.5214C14.233 14.3924 14.1765 14.227 14.1839 14.0582C14.1912 13.8895 14.2618 13.7297 14.3817 13.6106C14.5015 13.4916 14.6618 13.422 14.8306 13.4157C14.9994 13.4095 15.1643 13.467 15.2927 13.5768L17.0141 15.2859L18.7232 13.5768C18.8495 13.452 19.0201 13.3823 19.1977 13.3828C19.3753 13.3834 19.5454 13.4541 19.671 13.5797C19.7966 13.7053 19.8674 13.8754 19.8679 14.053C19.8684 14.2306 19.7987 14.4012 19.6739 14.5275L17.4756 16.712C17.353 16.8349 17.1876 16.9054 17.0141 16.9089Z" fill="${REPLACE_COLOR}"/>
      </g>
    </g>
    <defs>
      <clipPath id="clip0_6476_91062">
        <rect width="20" height="20" fill="white"/>
      </clipPath>
      <clipPath id="clip1_6476_91062">
        <rect width="19.9985" height="19.9985" fill="white" transform="translate(0 -0.00134277)"/>
      </clipPath>
    </defs>
  </svg>
`;
const ascSortNoFilter = `
  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_6476_91080)">
      <g clip-path="url(#clip1_6476_91080)">
      <path d="M16.8664 4.7052H1.16759C0.594111 4.7052 0.129211 5.1701 0.129211 5.74358C0.129211 6.31706 0.594111 6.78196 1.16759 6.78196H16.8664C17.4399 6.78196 17.9048 6.31706 17.9048 5.74358C17.9048 5.1701 17.4399 4.7052 16.8664 4.7052Z" fill="${REPLACE_COLOR}"/>
      <path d="M13.6851 8.95874H4.02123C3.44775 8.95874 2.98285 9.42364 2.98285 9.99712C2.98285 10.5706 3.44775 11.0355 4.02123 11.0355H13.6851C14.2586 11.0355 14.7235 10.5706 14.7235 9.99712C14.7235 9.42364 14.2586 8.95874 13.6851 8.95874Z" fill="${REPLACE_COLOR}"/>
      <path d="M10.833 13.2107H6.87487C6.30139 13.2107 5.83649 13.6756 5.83649 14.2491C5.83649 14.8226 6.30139 15.2875 6.87487 15.2875H10.833C11.4065 15.2875 11.8714 14.8226 11.8714 14.2491C11.8714 13.6756 11.4065 13.2107 10.833 13.2107Z" fill="${REPLACE_COLOR}"/>
      <path d="M17.0079 10.5509C17.1862 10.5509 17.3572 10.6217 17.4833 10.7478C17.6093 10.8738 17.6802 11.0448 17.6802 11.2231V16.2351C17.6802 16.4136 17.6093 16.5847 17.4831 16.711C17.3568 16.8372 17.1856 16.9081 17.0072 16.9081C16.8287 16.9081 16.6575 16.8372 16.5312 16.711C16.405 16.5847 16.3341 16.4136 16.3341 16.2351V11.2231C16.3341 11.0448 16.405 10.8738 16.531 10.7478C16.6571 10.6217 16.8296 10.5509 17.0079 10.5509Z" fill="${REPLACE_COLOR}"/>
      <path d="M17.0033 9.51408C17.0916 9.51346 17.179 9.53041 17.2606 9.56396C17.3423 9.5975 17.4164 9.64696 17.4787 9.70945L19.6754 11.9016C19.7844 12.0306 19.8409 12.196 19.8335 12.3647C19.8262 12.5335 19.7556 12.6933 19.6357 12.8123C19.5159 12.9314 19.3556 13.001 19.1868 13.0072C19.018 13.0135 18.853 12.956 18.7247 12.8461L17.0033 11.137L15.2942 12.8461C15.1679 12.9709 14.9973 13.0407 14.8197 13.0402C14.6421 13.0396 14.472 12.9688 14.3464 12.8433C14.2208 12.7177 14.15 12.5475 14.1495 12.3699C14.149 12.1924 14.2187 12.0218 14.3435 11.8954L16.5418 9.71099C16.6644 9.58812 16.8298 9.51754 17.0033 9.51408Z" fill="${REPLACE_COLOR}"/>
      </g>
    </g>
    <defs>
      <clipPath id="clip0_6476_91080">
        <rect width="20" height="20" fill="white"/>
      </clipPath>
      <clipPath id="clip1_6476_91080">
        <rect width="19.9985" height="19.9985" fill="white" transform="translate(0 -0.00292969)"/>
      </clipPath>
    </defs>
  </svg>
`;
const noSortHasFilter = `
  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_6476_91098)">
      <g clip-path="url(#clip1_6476_91098)">
        <path d="M4.008 5.07915C5.5695 7.06993 8.45229 10.7601 8.45229 10.7601V15.3715C8.45156 15.4738 8.47132 15.5752 8.51041 15.6699C8.5495 15.7645 8.60715 15.8505 8.67999 15.9228C8.75283 15.995 8.8394 16.0521 8.93466 16.0908C9.02993 16.1294 9.13198 16.1489 9.23486 16.1479H10.78C10.985 16.1474 11.1814 16.0662 11.3264 15.9221C11.4713 15.7779 11.553 15.5826 11.5535 15.3787V10.7601C11.5535 10.7601 14.429 7.06993 15.9905 5.07915C16.0795 4.96511 16.1344 4.8284 16.1488 4.68473C16.1632 4.54106 16.1366 4.39627 16.072 4.26698C16.0073 4.13769 15.9074 4.02916 15.7835 3.95385C15.6596 3.87854 15.5169 3.83951 15.3717 3.84124H4.6195C4.47494 3.84088 4.33318 3.8809 4.21038 3.95675C4.08758 4.03261 3.98868 4.14124 3.92494 4.27027C3.8612 4.39929 3.83519 4.54353 3.84988 4.68654C3.86456 4.82956 3.91935 4.96559 4.008 5.07915Z" fill="${REPLACE_COLOR}"/>
      </g>
    </g>
    <defs>
      <clipPath id="clip0_6476_91098">
        <rect width="20" height="20" fill="white"/>
      </clipPath>
      <clipPath id="clip1_6476_91098">
        <rect width="19.9985" height="19.9985" fill="white" transform="translate(0 -0.00463867)"/>
      </clipPath>
    </defs>
  </svg>
`;
const ascSortHasFilter = `
  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_6476_91109)">
      <g clip-path="url(#clip1_6476_91109)">
        <path d="M1.70044 5.84721C3.26195 7.838 6.14473 11.5282 6.14473 11.5282V16.1396C6.144 16.2419 6.16376 16.3433 6.20285 16.438C6.24195 16.5326 6.29959 16.6186 6.37243 16.6908C6.44527 16.7631 6.53184 16.8202 6.62711 16.8589C6.72237 16.8975 6.82442 16.9169 6.92731 16.916H8.47244C8.67743 16.9155 8.87389 16.8343 9.01884 16.6902C9.16379 16.546 9.24543 16.3506 9.24591 16.1468V11.5282C9.24591 11.5282 12.1214 7.838 13.6829 5.84721C13.772 5.73317 13.8268 5.59646 13.8413 5.4528C13.8557 5.30913 13.829 5.16433 13.7644 5.03505C13.6998 4.90576 13.5998 4.79722 13.4759 4.72191C13.352 4.6466 13.2093 4.60757 13.0641 4.60931H2.31194C2.16738 4.60894 2.02562 4.64897 1.90282 4.72482C1.78002 4.80067 1.68112 4.9093 1.61738 5.03833C1.55365 5.16736 1.52764 5.3116 1.54232 5.45461C1.55701 5.59762 1.61179 5.73366 1.70044 5.84721Z" fill="${REPLACE_COLOR}"/>
        <path d="M15.4695 10.5481C15.6478 10.5481 15.8188 10.6189 15.9449 10.745C16.071 10.871 16.1418 11.042 16.1418 11.2203V16.2322C16.1418 16.4107 16.0709 16.5819 15.9447 16.7081C15.8184 16.8344 15.6473 16.9053 15.4688 16.9053C15.2903 16.9053 15.1191 16.8344 14.9929 16.7081C14.8666 16.5819 14.7957 16.4107 14.7957 16.2322V11.2203C14.7957 11.042 14.8666 10.871 14.9926 10.745C15.1187 10.6189 15.2912 10.5481 15.4695 10.5481Z" fill="${REPLACE_COLOR}"/>
        <path d="M15.4649 9.51127C15.5532 9.51065 15.6406 9.5276 15.7223 9.56115C15.8039 9.59469 15.878 9.64415 15.9403 9.70664L18.137 11.8988C18.246 12.0278 18.3025 12.1932 18.2951 12.3619C18.2878 12.5307 18.2172 12.6905 18.0973 12.8095C17.9775 12.9286 17.8172 12.9982 17.6484 13.0044C17.4796 13.0107 17.3147 12.9532 17.1863 12.8433L15.4649 11.1342L13.7558 12.8433C13.6295 12.9681 13.4589 13.0379 13.2813 13.0374C13.1037 13.0368 12.9336 12.966 12.808 12.8405C12.6824 12.7149 12.6116 12.5447 12.6111 12.3671C12.6106 12.1895 12.6803 12.019 12.8051 11.8926L15.0034 9.70818C15.126 9.58531 15.2914 9.51473 15.4649 9.51127Z" fill="${REPLACE_COLOR}"/>
      </g>
    </g>
  <defs>
    <clipPath id="clip0_6476_91109">
      <rect width="20" height="20" fill="white"/>
    </clipPath>
    <clipPath id="clip1_6476_91109">
      <rect width="19.9985" height="19.9985" fill="white" transform="translate(0 -0.00427246)"/>
    </clipPath>
  </defs>
  </svg>
`;
const descSortHasFilter = `
  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_6476_91121)">
      <g clip-path="url(#clip1_6476_91121)">
        <path d="M1.70044 5.84685C3.26195 7.83763 6.14473 11.5278 6.14473 11.5278V16.1392C6.144 16.2415 6.16376 16.3429 6.20285 16.4376C6.24195 16.5322 6.29959 16.6182 6.37243 16.6905C6.44527 16.7627 6.53184 16.8198 6.62711 16.8585C6.72237 16.8972 6.82442 16.9166 6.92731 16.9156H8.47244C8.67743 16.9151 8.87389 16.8339 9.01884 16.6898C9.16379 16.5456 9.24543 16.3503 9.24591 16.1464V11.5278C9.24591 11.5278 12.1214 7.83763 13.6829 5.84685C13.772 5.73281 13.8268 5.5961 13.8413 5.45243C13.8557 5.30876 13.829 5.16397 13.7644 5.03468C13.6998 4.90539 13.5998 4.79686 13.4759 4.72155C13.352 4.64624 13.2093 4.60721 13.0641 4.60894H2.31194C2.16738 4.60858 2.02562 4.6486 1.90282 4.72445C1.78002 4.80031 1.68112 4.90894 1.61738 5.03797C1.55365 5.16699 1.52764 5.31123 1.54232 5.45425C1.55701 5.59726 1.61179 5.73329 1.70044 5.84685Z" fill="${REPLACE_COLOR}"/>
        <path d="M15.4374 15.8681C15.2591 15.8681 15.0881 15.7972 14.962 15.6712C14.836 15.5451 14.7651 15.3741 14.7651 15.1958V10.1839C14.7651 10.0054 14.836 9.83421 14.9623 9.70799C15.0885 9.58177 15.2597 9.51086 15.4382 9.51086C15.6167 9.51086 15.7878 9.58177 15.9141 9.70799C16.0403 9.83421 16.1112 10.0054 16.1112 10.1839V15.1958C16.1112 15.3741 16.0404 15.5451 15.9143 15.6712C15.7882 15.7972 15.6157 15.8681 15.4374 15.8681Z" fill="${REPLACE_COLOR}"/>
        <path d="M15.442 16.9049C15.3538 16.9055 15.2663 16.8885 15.1847 16.855C15.1031 16.8214 15.0289 16.772 14.9666 16.7095L12.7699 14.5174C12.6609 14.3883 12.6044 14.223 12.6118 14.0542C12.6191 13.8855 12.6898 13.7257 12.8096 13.6066C12.9294 13.4875 13.0897 13.418 13.2585 13.4117C13.4273 13.4054 13.5923 13.463 13.7206 13.5728L15.442 15.2819L17.1511 13.5728C17.2774 13.448 17.448 13.3782 17.6256 13.3788C17.8032 13.3793 17.9733 13.4501 18.0989 13.5757C18.2245 13.7013 18.2953 13.8714 18.2958 14.049C18.2964 14.2266 18.2266 14.3972 18.1018 14.5235L15.9035 16.708C15.7809 16.8308 15.6155 16.9014 15.442 16.9049Z" fill="${REPLACE_COLOR}"/>
      </g>
    </g>
    <defs>
      <clipPath id="clip0_6476_91121">
        <rect width="20" height="20" fill="white"/>
      </clipPath>
      <clipPath id="clip1_6476_91121">
        <rect width="19.9985" height="19.9985" fill="white" transform="translate(0 -0.00463867)"/>
      </clipPath>
    </defs>
  </svg>
`;

function getColumnHeaderIcon(
  sortOrder: OrderDirection | undefined,
  hasFilter: boolean,
  isActive: boolean,
) {
  const color = isActive ? ICON_ACTIVE_COLOR : ICON_NORMAL_COLOR;
  let svgData = '';

  if (!hasFilter) {
    if (sortOrder === 'asc') {
      svgData = ascSortNoFilter;
    } else if (sortOrder === 'desc') {
      svgData = descSortNoFilter;
    } else {
      svgData = noSortNoFilter;
    }
  } else {
    if (sortOrder === 'asc') {
      svgData = ascSortHasFilter;
    } else if (sortOrder === 'desc') {
      svgData = descSortHasFilter;
    } else {
      svgData = noSortHasFilter;
    }
  }

  return svgData.replace(REPLACE_COLOR_REGEX, color);
}

function getImageKey(
  sortOrder: OrderDirection | undefined,
  hasFilter: boolean,
  isActive: boolean,
) {
  const sort = sortOrder ?? 'no-sort';
  const filter = hasFilter ? 'filter' : 'no-filter';
  const active = isActive ? 'active' : 'no-active';
  return `${sort}_${filter}_${active}`;
}

const iconImageCache: Record<string, HTMLImageElement> = {};

export function getColumnHeaderIconImage(
  sortOrder: OrderDirection | undefined,
  hasFilter: boolean,
  isActive: boolean,
) {
  const key = getImageKey(sortOrder, hasFilter, isActive);
  if (iconImageCache[key]) return iconImageCache[key];
  const svgIcon = getColumnHeaderIcon(sortOrder, hasFilter, isActive);
  const image = createSvgIconImage(svgIcon);
  iconImageCache[key] = image;
  return image;
}

export function initColumnHeaderIconImages() {
  const filterData: Array<{
    sortOrder: OrderDirection;
    hasFilter: boolean;
  }> = [
    { sortOrder: undefined, hasFilter: false },
    { sortOrder: 'asc', hasFilter: false },
    { sortOrder: 'desc', hasFilter: false },
    { sortOrder: undefined, hasFilter: true },
    { sortOrder: 'asc', hasFilter: true },
    { sortOrder: 'desc', hasFilter: true },
  ];
  for (const data of filterData) {
    getColumnHeaderIconImage(data.sortOrder, data.hasFilter, false);
    getColumnHeaderIconImage(data.sortOrder, data.hasFilter, true);
  }
}
